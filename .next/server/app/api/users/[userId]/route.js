"use strict";(()=>{var e={};e.id=588,e.ids=[588],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},6595:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>S,originalPathname:()=>v,patchFetch:()=>I,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>b});var r={};a.r(r),a.d(r,{DELETE:()=>y,GET:()=>c,PUT:()=>g});var s=a(95419),o=a(69108),n=a(99678),l=a(3323),d=a(61969),i=a(87786),u=a(89166),p=a(6521);let c=async(e,{params:t})=>{try{await (0,u.P)();let{userId:e}=t,a=await l.Z.find({members:e}).sort({lastMessageAt:-1}).populate({path:"members",model:i.Z}).populate({path:"messages",model:d.Z,populate:{path:"sender seenBy",model:i.Z}}).exec();return new Response(JSON.stringify(a),{status:200})}catch(e){return console.log(e),new Response("Failed to get all chats of current user",{status:500})}},y=async(e,{params:t})=>{try{await (0,u.P)();let{userId:e}=t;console.log(e);let a=await i.Z.findByIdAndDelete(e);return new Response(JSON.stringify(a),{status:200})}catch(e){return console.log(e),new Response("Failed to search chat",{status:500})}},g=async(e,{params:t})=>{try{await (0,u.P)();let{username:a,fullName:r,password:s}=await e.json(),{userId:o}=t;console.log(o);let n=await i.Z.find();n?.filter(e=>{if(e?._id.toString()!==o.toString()){if(console.log(e),e?.username===a)throw Error("T\xean đăng nhập đ\xe3 tồn tại");if(r===e?.fullName)throw Error("T\xean t\xe0i khoản đ\xe3 tồn tại")}});let l=await (0,p.hash)(s,10);console.log(a,s,r);let d=await i.Z.findByIdAndUpdate(o,{fullName:r,username:a,password:l},{new:!0});return new Response(JSON.stringify(d),{status:200})}catch(e){return console.log(e),new Response("Failed to search chat",{status:500})}},h=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/users/[userId]/route",pathname:"/api/users/[userId]",filename:"route",bundlePath:"app/api/users/[userId]/route"},resolvedPagePath:"D:\\company\\halo_cha6\\app\\api\\users\\[userId]\\route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:w,headerHooks:S,staticGenerationBailout:b}=h,v="/api/users/[userId]/route";function I(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}},3323:(e,t,a)=>{a.d(t,{Z:()=>n});var r=a(11185),s=a.n(r);let o=new(s()).Schema({members:{type:[{type:s().Schema.Types.ObjectId,ref:"User"}],default:[]},messages:{type:[{type:s().Schema.Types.ObjectId,ref:"Message"}],default:[]},isGroup:{type:Boolean,default:!1},name:{type:String,default:""},groupPhoto:{type:String,default:""},createdAt:{type:Date,default:Date.now},lastMessageAt:{type:Date,default:Date.now}}),n=s().models.Chat||s().model("Chat",o)},61969:(e,t,a)=>{a.d(t,{Z:()=>n});var r=a(11185),s=a.n(r);let o=new(s()).Schema({chat:{type:s().Schema.Types.ObjectId,ref:"Chat"},sender:{type:s().Schema.Types.ObjectId,ref:"User"},text:{type:String,default:""},photo:{type:String,default:""},createdAt:{type:Date,default:Date.now},seenBy:{type:[{type:s().Schema.Types.ObjectId,ref:"User"}],default:[]}}),n=s().models.Message||s().model("Message",o)},87786:(e,t,a)=>{a.d(t,{Z:()=>n});var r=a(11185),s=a.n(r);let o=new(s()).Schema({username:{type:String,required:!0},fullName:{type:String,required:!0},password:{type:String,required:!0},profileImage:{type:String,default:""},role:{type:String,default:"user"},chats:{type:[{type:s().Schema.Types.ObjectId,ref:"Chat"}],default:[]},code:{type:String},codeAddFriends:{type:String}}),n=s().models.User||s().model("User",o)},89166:(e,t,a)=>{a.d(t,{P:()=>n});var r=a(11185),s=a.n(r);let o=!1,n=async()=>{if(s().set("strictQuery",!0),o){console.log("MongoDB is already connected");return}try{await s().connect("mongodb+srv://tanquanga6k10:CpdAVLjkbtX5chAq@shopdientu.l5fgtvm.mongodb.net/shopdientu?retryWrites=true&w=majority",{dbName:"HaloChat",useNewUrlParser:!0,useUnifiedTopology:!0}),o=!0,console.log("MongoDB is connected successfully")}catch(e){console.log(e)}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[638,696],()=>a(6595));module.exports=r})();